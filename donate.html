<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>zeroHunger | Donate Food</title>
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="stylesheet" href="css/donate.css" type="text/css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Paytone+One&family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css" crossorigin>
  <!-- Validation css -->
  <style>
    .is-invalid {
      border-color: red;
    }

    .error-message {
      color: red;
      font-size: 0.875em;
    }
  </style>
</head>

<body>
  <!--Header-->
  <nav class="navbar navbar-expand-sm bg-white text-dark justify-content-center fixed-top">
    <div class="container-fluid justify-content-space-between">
      <div id="logo">zero<a class="navbar-brand" href="index.html" translate="no" id="logo-s">Hunger</a></div>
      <button class="navbar-toggler border-white" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapsibleNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-center" id="collapsibleNavbar">
        <ul class="navbar-nav align-items-center fw-bold" style="text-transform: uppercase;">
          <li class="nav-item" style="white-space: nowrap;">
            <a class="nav-link" href="catalogue.html">Catalogue</a>
          </li>
          <li class="nav-item" style="white-space: nowrap;">
            <a class="nav-link" href="aboutus.html">About Us</a>
          </li>
          <li class="nav-item" style="white-space: nowrap;">
            <a class="nav-link" href="contactus.html">Contact Us</a>
          </li>
        </ul>
      </div>
      <!-- Fund Us Button -->
      <span class="background">
        <a href="fundus.html" class='button'>
          <svg>
            <rect x="0" y="0" fill="none" width="100%" height="100%" />
          </svg>
          Fund Us
        </a>
      </span>
    </div>
  </nav>
  <!-- Donate Form -->
  <div class="form-wrapper mt-5">
    <div class="form-side mt-2">
      <form class="my-form" id="donation-form">
        <div class="form-heading-row">
          <h1 style="text-align: center;">Donate <span style="color: #209CEE;">Food</span></h1>
        </div>
        <!-- divider line -->
        <div class="divider">
          <div class="divider-line"></div>
        </div>
        <!-- form input fields -->
        <!-- item name -->
        <div class="text-field">
          <label for="food-name">Name of Food
            <input type="text" id="food-name" name="food-name" autocomplete="on" class="controls" spellcheck="true"
              placeholder="" style="text-transform: lowercase;" required>
          </label>
          <div class="error-message" id="food-name-error"></div>
        </div>
        <!-- item type -->
        <div class="text-field">
          <label class="required" for="food-type">Food type</label>
          <select name="food-type" id="food-type" placeholder="Select the item to be donated" class="controls" required>
            <option value="">Select Food Type</option>
            <option>Cereal</option>
            <option>Meat</option>
            <option>Fish</option>
            <option>Grain</option>
            <option>Fruit</option>
            <option>Vegetable</option>
            <option>Nuts and Seed</option>
            <option>Dairy product</option>
            <option>Bread</option>
            <option>Prepared food</option>
            <option>Root vegetable (Tubers)</option>
            <option>Egg</option>
            <option>Others</option>
          </select>
          <div class="error-message" id="food-type-error"></div>
        </div>
        <!-- Manufactured Date -->
        <div class="text-field">
          <label for="mandate">Manufactured Date
            <input type="date" id="mandate" name="mandate" autocomplete="off" placeholder="" class="controls" required>
          </label>
          <div class="error-message" id="mandate-error"></div>
        </div>
        <!-- Expiry date -->
        <div class="text-field">
          <label for="expdate">Expiry Date
            <input type="date" id="expdate" name="expdate" autocomplete="off" placeholder="" class="controls" required>
          </label>
          <div class="error-message" id="expdate-error"></div>
        </div>
        <!-- Food bank centers -->
        <div class="text-field">
          <label class="required" for="foodbank-center">FoodBank Center</label>
          <select name="foodbank-center" id="foodbank-center" placeholder="Select foodbank center for donation"
            class="controls" required>
            <option value="">Select FoodBank Center</option>
            <option value="Food Bank center, KNUST">Food Bank center, KNUST</option>
            <option value="Food science department, College of Science, KNUST">Food science department, College of Science, KNUST</option>
            <option value="Faculty of Agriculture, KNUST">College of Agriculture, KNUST</option>
            <option value="Community Center, KNUST">Community Center, KNUST</option>
            <option value="Brunei Complex, KNUST">Brunei Complex, KNUST</option>
          </select>
          <div class="error-message" id="foodbank-center-error"></div>
        </div>
        <!-- pick up date -->
        <div class="text-field">
          <label for="donatedate">Available date for donation
            <input type="date" id="donatedate" name="donatedate" autocomplete="off" placeholder="" class="controls" required>
          </label>
          <div class="error-message" id="donatedate-error"></div>
        </div>
        <!-- pickup time -->
        <div class="text-field">
          <label for="time">Time for donation
            <input type="time" id="time" name="time" autocomplete="off" placeholder="" class="controls" required>
          </label>
          <div class="error-message" id="time-error"></div>
        </div>
        <!-- image upload -->
        <div class="image-upload">
          <label for="imageFile" style="font-weight: 600;">Picture of item
            <br><br><input type="file" id="imageFile" name="imageFile" class="controls" required>
          </label>
          <div class="error-message" id="imageFile-error"></div>
        </div>
        <!-- additional textarea box -->
        <textarea class="controls" maxlength="125" name="message" id="message" spellcheck="true"
          autocapitalize="true" autocomplete="on" placeholder="Additional details of item"
          title="Must contain a maximum of 125 characters" required></textarea>
        <div class="error-message" id="message-error"></div>
        
        <!-- divider line -->
        <div class="divider mt-3">
          <div class="divider-line"></div>
        </div>
        <!-- contact details -->
        <div class="form-heading-row">
          <h1 style="text-align: center;">Contact Details</h1>
        </div>
        <!-- donor name -->
        <div class="text-field">
          <label for="donor-name">Name of Donor
            <input type="text" id="donor-name" name="donor-name" autocomplete="on" spellcheck="true" placeholder=""
              class="controls" required>
          </label>
          <div class="error-message" id="donor-name-error"></div>
        </div>
        <!-- Donor phone number -->
        <div class="text-field">
          <label for="donor-phone">Phone number of Donor
            <input type="tel" id="donor-phone" name="donor-phone" placeholder="" class="controls" maxlength="10" required>
          </label>
          <div class="error-message" id="donor-phone-error"></div>
        </div>
        <!-- Donor email -->
        <div class="text-field">
          <label for="donor-email">Email of Donor
            <input type="email" id="donor-email" name="donor-email" autocomplete="on" placeholder="" class="controls" required>
          </label>
          <div class="error-message" id="donor-email-error"></div>
        </div>
        <!-- divider line -->
        <!-- <div class="divider mt-3">
          <div class="divider-line"></div>
        </div> -->
        <div class="form-group form-button">
          <button type="submit" id="btn" name="btn" class="donate-food my-form__button">Donate Food</button>
        </div>
      </form>
    </div>
     <!-- side info gif -->
     <div class="info-side">
      <img src="images/fooddonation2.jpg" alt="animated donation image" class="donation-image" />
    </div>
  </div>
  </div>
  <!-- Footer -->
  <div class="myfooter">
    <section class="footer">
        <div class="foot">
            <div class="footer-content">

                <div class="footlinks">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="donate.html">Donate</a></li>
                        <li><a href="aboutus.html">About Us</a></li>
                        <li><a href="contactus.html">Contact Us</a></li>
                        <li><a href="blog.html">Our Blog</a></li>
                        <li><a href="fundus.html">Fund Us</a></li>
                    </ul>
                </div>

                <div class="footlinks">
                    <h4>Connect</h4>
                    <div class="social">
                      <a href="https://www.facebook.com/WorldFoodProgramme?locale=hy_AM" target="_blank"><i class='bx bxl-facebook'></i></a>
                      <a href="https://www.instagram.com/Worldfoodprogramme/?hl=en" target="_blank"><i class='bx bxl-instagram'></i></a>
                      <a href="https://www.linkedin.com/company/unwfp/posts/?feedView=all" target="_blank"><i class='bx bxl-linkedin'></i></a>
                      <a href="https://www.youtube.com/@UNFAO" target="_blank"><i class='bx bxl-youtube'></i></a>
                    </div>
                </div>

            </div>
        </div>

        <div class="end">
            <p>Tel: 024 114 5862 | <a href="mailto:kobbyfrimpz89@gmail.com"
                    style="text-decoration: none; color: white;">Email: support@zeroHunger.com</a> | Copyright ©
                2024 zeroHunger | All Rights Reserved <br>Website developed by: zeroHunger | Computer Science
                Department | KNUST.</p>
        </div>
    </section>
</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  document.getElementById('donation-form').addEventListener('submit', async function(event) {
    event.preventDefault(); // Prevent form from submitting normally

    // Get form data
    const form = event.target;
    const formData = new FormData(form);
    const donationData = {
      foodName: formData.get('food-name'),
      foodType: formData.get('food-type'),
      manufactureDate: formData.get('mandate'),
      expiryDate: formData.get('expdate'),
      foodbankCenter: formData.get('foodbank-center'),
      donationDate: formData.get('donatedate'),
      donationTime: formData.get('time'),
      additionalDetails: formData.get('message'),
      donorName: formData.get('donor-name'),
      donorPhone: '+233' + formData.get('donor-phone').slice(-9),
      donorEmail: formData.get('donor-email'),
      referenceNumber: 'REF' + Math.floor(Math.random() * 9000000000) + 1000000000
    };

    // Generate a time 3 hours from the donation time
    const donationDateTime = new Date(`${donationData.donationDate}T${donationData.donationTime}`);
    const timeLimit = new Date(donationDateTime.getTime() + 3 * 60 * 60 * 1000);
    const formattedTimeLimit = timeLimit.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    // Save to local storage
    let donations = JSON.parse(localStorage.getItem('donations')) || [];
    donations.push(donationData);
    localStorage.setItem('donations', JSON.stringify(donations));

    // Send SMS using Infobip API
    const smsMessage = `Dear ${donationData.donorName}, your donation (Ref: ${donationData.referenceNumber}) of ${donationData.foodName} to ${donationData.foodbankCenter} is scheduled for ${donationData.donationDate}. Please ensure to complete the donation by ${formattedTimeLimit}.`;

    const smsData = {
      from: "zeroHunger",
      to: donationData.donorPhone,
      text: smsMessage
    };

    try {
      const response = await fetch('https://vvnmvr.api.infobip.com/sms/2/text/single', {
        method: 'POST',
        headers: {
          'Authorization': 'App 0511e843c836a4715509f9058242735f-b54b1085-0a13-4569-bef1-16a809ff21a5',
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(smsData)
      });

      if (!response.ok) {
        throw new Error('Failed to send SMS');
      }

      // Show success message
      Swal.fire({
        title: 'Donation Submitted!',
        html: `Your food donation has been successfully submitted. Please proceed to make your food donation at ${donationData.foodbankCenter}<br><br>Reference Number: ${donationData.referenceNumber}<br>Available Date for Donation: ${donationData.donationDate}`,
        icon: 'success',
        confirmButtonText: 'OK'
      }).then(() => {
        form.reset(); // Clear the form
      });
    } catch (error) {
      console.error(error);
      Swal.fire({
        title: 'Error!',
        text: 'There was an issue sending the confirmation SMS. Please try again.',
        icon: 'error',
        confirmButtonText: 'OK'
      });
    }
  });
</script>
</body>

</html>
